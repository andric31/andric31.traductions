<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stats â€” Traductions</title>

  <link rel="icon" href="/favicon.png" />
  <link rel="stylesheet" href="/stats/stats.css" />
<style>
/* ===== Help Tooltip (clean) ===== */
.tab-section.tooltip-safe{ overflow: visible; }
.card.tooltip-safe{ overflow: visible; } /* Ã©vite le dÃ©coupage dÃ» au overflow:hidden */

.help-tip{
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 18px;
  height: 18px;
  margin-left: 8px;
  border-radius: 999px;
  font-weight: 800;
  font-size: 12px;
  line-height: 1;
  cursor: help;
  user-select: none;
  background: rgba(255,255,255,0.10);
  border: 1px solid rgba(255,255,255,0.22);
  z-index: 999998;
}

.help-tip:hover{
  background: rgba(255,255,255,0.14);
}

.help-tip:focus{
  outline: 2px solid rgba(255,255,255,0.35);
  outline-offset: 2px;
}

.help-bubble{
  position: absolute;
  left: 0;
  top: calc(100% + 10px);
  transform: translateX(-10px);
  width: min(420px, 86vw);
  padding: 12px 14px;
  border-radius: 14px;
  background: rgba(16, 18, 24, 0.98);
  border: 1px solid rgba(255,255,255,0.16);
  box-shadow: 0 14px 40px rgba(0,0,0,0.45);
  color: rgba(255,255,255,0.94);
  font-size: 13px;
  line-height: 1.45;
  text-align: left;
  z-index: 99999;

  opacity: 0;
  pointer-events: none;
  transition: opacity .14s ease, transform .14s ease;
  z-index: 999999;
}

.help-bubble b{
  color: #fff;
}

.help-bubble::before{
  content: "";
  position: absolute;
  top: -6px;
  left: 22px;
  width: 10px;
  height: 10px;
  background: rgba(16, 18, 24, 0.98);
  border-left: 1px solid rgba(255,255,255,0.16);
  border-top: 1px solid rgba(255,255,255,0.16);
  transform: rotate(45deg);
}

.help-tip:hover .help-bubble,
.help-tip:focus .help-bubble{
  opacity: 1;
  pointer-events: auto;
  transform: translateX(-10px) translateY(0);
  z-index: 999999;
}
</style>
<style>
/* ===== Global Tooltip (fixed, never clipped) ===== */
#globalTooltip{
  position: fixed;
  left: 0;
  top: 0;
  max-width: min(460px, 92vw);
  padding: 12px 14px;
  border-radius: 14px;
  background: rgba(16,18,24,0.985);
  border: 1px solid rgba(255,255,255,0.16);
  box-shadow: 0 16px 50px rgba(0,0,0,0.55);
  color: rgba(255,255,255,0.94);
  font-size: 13px;
  line-height: 1.45;
  z-index: 2147483647; /* au-dessus de tout */
  opacity: 0;
  pointer-events: none;
  transform: translate3d(0,0,0) scale(0.985);
  transition: opacity .12s ease, transform .12s ease;
  display: none;
}
#globalTooltip b{ color:#fff; }

#globalTooltip.show{
  display: block;
  opacity: 1;
  transform: translate3d(0,0,0) scale(1);
}
#globalTooltip::before{
  content:"";
  position:absolute;
  width:10px;
  height:10px;
  background: rgba(16,18,24,0.985);
  border-left: 1px solid rgba(255,255,255,0.16);
  border-top: 1px solid rgba(255,255,255,0.16);
  transform: rotate(45deg);
}
#globalTooltip::before{
  left: var(--_gtArrowLeft, 22px);
  top: var(--_gtArrowTop, -6px);
  transform: rotate(var(--_gtArrowRot, 45deg));
}
</style>
<style>/* hide inline bubble, use global */ .help-tip .help-bubble{display:none !important;}</style>
</head>

<body class="stats-page">
  <div class="stats-wrap">
    <main class="stats-main">

      <section class="card">
        <div class="card-h tabs-h">
          <div class="tabs">
            <button class="tab-btn is-active" data-tab="overview" type="button">Overview</button>
            <button class="tab-btn" data-tab="trending" type="button">Trending</button>
            <button class="tab-btn" data-tab="timeline" type="button">Timeline</button>
            <button class="tab-btn" data-tab="ratings" type="button">Ratings</button>
          </div>
          <div class="tabs-actions">
            <button id="btnExportCsv" class="btn btn-ghost" type="button" title="Exporter en CSV">â¬‡ï¸ CSV</button>
          </div>
        </div>
      </section>

      <section class="tab-section" id="tab_overview">
        <section class="card">
          <div class="card-h">
            <div class="stats-title">
              <div class="h1">ğŸ“Š Stats</div>
              <div class="sub">https://andric31-traductions.pages.dev/</div>
            </div>

            <div class="stats-controls">
              <input id="q" class="inp" placeholder="Rechercher (titre, tags, idâ€¦)" autocomplete="off" />

              <select id="range" class="sel" title="PÃ©riode">
                <option value="total" selected>Total</option>
                <option value="24h">24h</option>
                <option value="7d">7j</option>
              </select>

              <select id="metric" class="sel" title="MÃ©trique du graphique">
                <option value="views">ğŸ‘ï¸ Vues</option>
                <option value="mega">ğŸ“¥ TÃ©lÃ©chargements</option>
                <option value="likes">â¤ï¸ Likes</option>
                <option value="ratingCount">â­ğŸ—³ï¸ Votes</option>
                <option value="ratingAvg">â­ Note (moy.)</option>
              </select>

              <select id="top" class="sel" title="Top">
                <option value="20" selected>Top 20</option>
                <option value="30">Top 30</option>
                <option value="40">Top 40</option>
                <option value="50">Top 50</option>
                <option value="100">Top 100</option>
                <option value="200">Top 200</option>
                <option value="300">Top 300</option>
                <option value="400">Top 400</option>
                <option value="500">Top 500</option>
                <option value="600">Top 600</option>
                <option value="700">Top 700</option>
                <option value="800">Top 800</option>
                <option value="900">Top 900</option>
                <option value="0">Tout</option>
              </select>
            </div>
          </div>

          <div class="site-kpis" id="siteKpis" aria-label="Stats du site">
            <div class="kpi"><span class="kpi-l">ğŸ‘ï¸ Vues page principale</span><span class="kpi-v" id="siteViews">â€”</span></div>
            <div class="kpi"><span class="kpi-l">â±ï¸ 24h</span><span class="kpi-v" id="siteViews24h">â€”</span></div>
            <div class="kpi"><span class="kpi-l">ğŸ“… 7j</span><span class="kpi-v" id="siteViews7d">â€”</span></div>

            <div class="kpi"><span class="kpi-l">ğŸ® Vues pages de jeu (total)</span><span class="kpi-v" id="gamesViews">â€”</span></div>
            <div class="kpi"><span class="kpi-l">â±ï¸ 24h</span><span class="kpi-v" id="gamesViews24h">â€”</span></div>
            <div class="kpi"><span class="kpi-l">ğŸ“… 7j</span><span class="kpi-v" id="gamesViews7d">â€”</span></div>

            <div class="kpi"><span class="kpi-l">ğŸ“¥ TÃ©lÃ©chargements (total jeux)</span><span class="kpi-v" id="gamesMega">â€”</span></div>
            <div class="kpi"><span class="kpi-l">â±ï¸ 24h</span><span class="kpi-v" id="gamesMega24h">â€”</span></div>
            <div class="kpi"><span class="kpi-l">ğŸ“… 7j</span><span class="kpi-v" id="gamesMega7d">â€”</span></div>

            <div class="kpi"><span class="kpi-l">â¤ï¸ Likes (total jeux)</span><span class="kpi-v" id="gamesLikes">â€”</span></div>
            <div class="kpi"><span class="kpi-l">â±ï¸ 24h</span><span class="kpi-v" id="gamesLikes24h">â€”</span></div>
            <div class="kpi"><span class="kpi-l">ğŸ“… 7j</span><span class="kpi-v" id="gamesLikes7d">â€”</span></div>
          </div>
        </section>

        <section class="card">
          <div class="card-h">
            <div class="card-title">Graphique (Top)</div>
            <div class="card-actions">
              <div class="card-note" id="statusChart">Chargementâ€¦</div>
              <button id="btnChartExpand" class="btn-chart" type="button" title="Ã‰tendre le graphique">â¤¢</button>
            </div>
          </div>
          <div class="chart-wrap">
            <canvas id="chart" width="1400" height="560"></canvas>
          </div>
        </section>

        <section class="card">
          <div class="card-h">
            <div class="card-title">Tableau</div>
            <div class="card-note" id="statusTable">â€”</div>
          </div>

          <div class="table-wrap">
            <table class="tbl" id="tbl">
              <thead>
                <tr>
                  <th class="c-cover">Cover</th>
                  <th data-sort="title">Titre</th>
                  <th class="num" data-sort="views">ğŸ‘ï¸</th>
                  <th class="num" data-sort="mega">ğŸ“¥</th>
                  <th class="num" data-sort="likes">â¤ï¸</th>
                  <th class="num" data-sort="ratingCount">â­ğŸ—³ï¸</th>
                  <th class="num" data-sort="ratingAvg">â­</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>
        </section>
      </section>

      <section class="tab-section" id="tab_trending" style="display:none;">
        <section class="card" tooltip-safe>
          <div class="card-h">
            <div class="card-title">
ğŸ”¥ Trending
<span class="help-tip" tabindex="0">?
  <span class="help-bubble">
    <b>Trending</b> = ce qui monte vite en ce moment ğŸ“ˆ<br>
    Classement basÃ© sur la progression rÃ©cente (vues / likes / clics Mega).<br><br>
    ğŸ‘‰ Indicateur de momentum, pas du total historique.
  </span>
</span>
</div>
            <div class="stats-controls">
              <select id="trendWindow" class="sel" title="FenÃªtre">
                <option value="24h" selected>24h</option>
                <option value="7d">7j</option>
              </select>

              <select id="trendMetric" class="sel" title="MÃ©trique">
                <option value="views" selected>ğŸ‘ï¸ Vues</option>
                <option value="mega">ğŸ“¥ TÃ©lÃ©chargements</option>
                <option value="likes">â¤ï¸ Likes</option>
              </select>

              <select id="trendEngine" class="sel" title="Moteur">
                <option value="" selected>ğŸ® Tous moteurs</option>
              </select>

              <select id="trendStatus" class="sel" title="Statut">
                <option value="" selected>ğŸ“Œ Tous statuts</option>
              </select>

              <input id="trendTag" class="inp" placeholder="Filtre tag (ex: renpy, incestâ€¦)" autocomplete="off" />
            </div>
          </div>

          <div class="mini-kpis">
            <div class="kpi"><span class="kpi-l">Total fenÃªtre</span><span class="kpi-v" id="trendTotal">â€”</span></div>
            <div class="kpi"><span class="kpi-l">Jeux visibles</span><span class="kpi-v" id="trendCount">â€”</span></div>
          </div>
        </section>

        <section class="card">
          <div class="card-h">
            <div class="card-title">Graphique (Trending)</div>
            <div class="card-note" id="trendStatusLine">â€”</div>
          </div>
          <div class="chart-wrap">
            <canvas id="trendChart" width="1400" height="560"></canvas>
          </div>
        </section>

        <section class="card">
          <div class="card-h">
            <div class="card-title">Tableau (Trending)</div>
            <div class="card-note" id="trendTableStatus">â€”</div>
          </div>
          <div class="table-wrap">
            <table class="tbl" id="trendTbl">
              <thead>
                <tr>
                  <th class="c-cover">Cover</th>
                  <th>Titre</th>
                  <th class="num">Score</th>
                  <th class="num">FenÃªtre</th>
                  <th class="num">Total</th>
                </tr>
              </thead>
              <tbody id="trendTbody"></tbody>
            </table>
          </div>
        </section>
      </section>

      <section class="tab-section" id="tab_timeline" style="display:none;">
        <section class="card" tooltip-safe>
          <div class="card-h">
            <div class="card-title">
ğŸ•’ Timeline (rapide)
<span class="help-tip" tabindex="0">?
  <span class="help-bubble">
    <b>Timeline</b> = quand lâ€™activitÃ© arrive ğŸ•’<br>
    Vue chronologique des Ã©vÃ©nements rÃ©cents (vues / likes / tÃ©lÃ©chargements).<br><br>
    ğŸ‘‰ Permet de repÃ©rer les pics aprÃ¨s une mise Ã  jour ou un post Discord.
  </span>
</span>
</div>
            <div class="card-note">Pas une vraie courbe/jour (pas d'historique D1), mais un rÃ©sumÃ© â€œactivitÃ© rÃ©centeâ€.</div>
          </div>

          <div class="site-kpis">
            <div class="kpi"><span class="kpi-l">ğŸ‘ï¸ Vues jeux Â· 24h</span><span class="kpi-v" id="tlViews24h">â€”</span></div>
            <div class="kpi"><span class="kpi-l">ğŸ“¥ TÃ©lÃ©ch. jeux Â· 24h</span><span class="kpi-v" id="tlMega24h">â€”</span></div>
            <div class="kpi"><span class="kpi-l">â¤ï¸ Likes jeux Â· 24h</span><span class="kpi-v" id="tlLikes24h">â€”</span></div>

            <div class="kpi"><span class="kpi-l">ğŸ‘ï¸ Vues jeux Â· 7j</span><span class="kpi-v" id="tlViews7d">â€”</span></div>
            <div class="kpi"><span class="kpi-l">ğŸ“¥ TÃ©lÃ©ch. jeux Â· 7j</span><span class="kpi-v" id="tlMega7d">â€”</span></div>
            <div class="kpi"><span class="kpi-l">â¤ï¸ Likes jeux Â· 7j</span><span class="kpi-v" id="tlLikes7d">â€”</span></div>
          </div>
        </section>

        <section class="card">
          <div class="card-h">
            <div class="card-title">ğŸš€ Top movers (24h)</div>
            <div class="card-note" id="tlMoversStatus">â€”</div>
          </div>
          <div class="table-wrap">
            <table class="tbl">
              <thead>
                <tr>
                  <th class="c-cover">Cover</th>
                  <th>Titre</th>
                  <th class="num">ğŸ‘ï¸ 24h</th>
                  <th class="num">ğŸ“¥ 24h</th>
                  <th class="num">â¤ï¸ 24h</th>
                </tr>
              </thead>
              <tbody id="tlTbody"></tbody>
            </table>
          </div>
        </section>
      </section>

      <section class="tab-section" id="tab_ratings" style="display:none;">
        <section class="card">
          <div class="card-h">
            <div class="card-title">â­ Ratings</div>
            <div class="stats-controls">
              <select id="bayesM" class="sel" title="Force du prior (m)">
                <option value="5">m=5 (rapide)</option>
                <option value="10" selected>m=10 (Ã©quilibrÃ©)</option>
                <option value="20">m=20 (strict)</option>
                <option value="50">m=50 (IMDB-like)</option>
              </select>
              <select id="ratingsTop" class="sel" title="Top">
                <option value="20" selected>Top 20</option>
                <option value="50">Top 50</option>
                <option value="100">Top 100</option>
                <option value="0">Tout</option>
              </select>
            </div>
          </div>

          <div class="mini-kpis">
            <div class="kpi"><span class="kpi-l">Moyenne globale (C)</span><span class="kpi-v" id="bayesC">â€”</span></div>
            <div class="kpi"><span class="kpi-l">Jeux notÃ©s</span><span class="kpi-v" id="ratedCount">â€”</span></div>
          </div>
        </section>

        <section class="card">
          <div class="card-h">
            <div class="card-title">Graphique (Bayesian)</div>
            <div class="card-note" id="ratingsStatusLine">â€”</div>
          </div>
          <div class="chart-wrap">
            <canvas id="ratingsChart" width="1400" height="560"></canvas>
          </div>
        </section>

        <section class="card">
          <div class="card-h">
            <div class="card-title">Classement Bayesian</div>
            <div class="card-note" id="ratingsTableStatus">â€”</div>
          </div>
          <div class="table-wrap">
            <table class="tbl" id="ratingsTbl">
              <thead>
                <tr>
                  <th class="c-cover">Cover</th>
                  <th>Titre</th>
                  <th class="num">Bayes</th>
                  <th class="num">â­ Moy.</th>
                  <th class="num">ğŸ—³ï¸ Votes</th>
                </tr>
              </thead>
              <tbody id="ratingsTbody"></tbody>
            </table>
          </div>
        </section>
      </section>

    </main>
  </div>

  <script src="/stats/stats.js"></script>
<script>
/* ===== Global Tooltip logic (fixed) ===== */
(function(){
  const TT_ID = "globalTooltip";
  let tt = document.getElementById(TT_ID);
  if(!tt){
    tt = document.createElement("div");
    tt.id = TT_ID;
    document.body.appendChild(tt);
  }

  function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

  function showTip(anchor){
    // rÃ©cupÃ¨re le HTML depuis .help-bubble (si prÃ©sent)
    const bubble = anchor.querySelector(".help-bubble");
    const html = bubble ? bubble.innerHTML : (anchor.getAttribute("data-tip") || "");
    if(!html) return;

    tt.innerHTML = html;

    // mesure
    tt.style.display = "block";
    tt.classList.add("show");

    const a = anchor.getBoundingClientRect();
    const pad = 10;
    const vw = window.innerWidth;
    const vh = window.innerHeight;

    // choisir position: au-dessus si pas assez de place en dessous
    tt.style.left = "0px";
    tt.style.top = "0px";
    // force layout for accurate size
    const ttr = tt.getBoundingClientRect();

    const preferBelow = (a.bottom + pad + ttr.height) <= (vh - pad);
    const top = preferBelow ? (a.bottom + pad) : (a.top - pad - ttr.height);

    // aligner Ã  gauche du ? avec marge, mais clamp dans viewport
    let left = a.left - 10;
    left = clamp(left, pad, vw - pad - ttr.width);

    tt.style.left = Math.round(left) + "px";
    tt.style.top  = Math.round(top) + "px";

    // flÃ¨che
    const arrow = 6; // taille
    const arrowX = clamp((a.left + a.width/2) - left, 14, ttr.width - 14);
    if(preferBelow){
      tt.style.setProperty("--arrow-top", "-6px");
      tt.style.setProperty("--arrow-rot", "45deg");
      tt.style.setProperty("--arrow-y", "-6px");
      tt.style.setProperty("--arrow-border", "top");
      tt.style.setProperty("--arrow-pos", "top");
      tt.style.setProperty("--arrow-offset", "0");
      tt.style.setProperty("--arrow-dir", "down");
      tt.style.setProperty("--arrow-place", "top");
      tt.style.setProperty("--arrow", "below");
      tt.style.setProperty("--arrow-y", "-6px");
      tt.style.setProperty("--arrow-x", arrowX + "px");
      tt.style.setProperty("--arrow-mode", "below");
      tt.style.setProperty("--arrow-left", arrowX + "px");
      tt.style.setProperty("--arrow-top", "-6px");
      tt.style.setProperty("--arrow-rotate", "45deg");
      tt.style.setProperty("--arrow-bg", "rgba(16,18,24,0.985)");
      tt.style.setProperty("--arrow-border-color", "rgba(255,255,255,0.16)");
      tt.style.setProperty("--arrow-border", "1px");
      tt.style.setProperty("--arrow-side", "top");
      tt.style.setProperty("--arrow-px", "-6px");
      tt.style.setProperty("--arrow-posy", "-6px");
      tt.style.setProperty("--arrow-posx", arrowX + "px");
      tt.style.setProperty("--arrow-where", "top");
      tt.style.setProperty("--arrow", "1");
      tt.style.setProperty("--arrow-anchor", "top");
      tt.style.setProperty("--arrow-offset-y", "-6px");
      tt.style.setProperty("--arrow-offset-x", arrowX + "px");
      tt.style.setProperty("--arrowTransform", "rotate(45deg)");
      tt.style.setProperty("--arrowTop", "-6px");
      tt.style.setProperty("--arrowLeft", arrowX + "px");
      tt.style.setProperty("--arrowRotate", "45deg");
      tt.style.setProperty("--arrowFlip", "0");
      tt.style.setProperty("--arrowBorderLeft", "1px");
      tt.style.setProperty("--arrowBorderTop", "1px");

      tt.style.setProperty("--arrow-isAbove", "0");
      tt.style.setProperty("--arrow-isBelow", "1");
      tt.style.setProperty("--arrowMargin", "-6px");

      tt.style.setProperty("--arrowX", arrowX + "px");
      tt.style.setProperty("--arrowY", "-6px");

      tt.style.setProperty("--arrowPos", "top");
      tt.style.setProperty("--arrowPosPx", "-6px");

      tt.style.setProperty("--arrowAngle", "45deg");

      tt.style.setProperty("--arrowL", arrowX + "px");
      tt.style.setProperty("--arrowT", "-6px");
      tt.style.setProperty("--arrowR", "45deg");

      tt.style.setProperty("--arrow-dummy","1");
      tt.style.setProperty("--arrow2","1");

      tt.style.setProperty("--arrowAAA","1");

      tt.style.setProperty("--arrow-point","1");

      tt.style.setProperty("--arrow-fixed","1");

      tt.style.setProperty("--arrow-prefer","below");
      // set actual pseudo-element
      tt.style.setProperty("--_arrowLeft", arrowX + "px");
      tt.style.setProperty("--_arrowTop", "-6px");
      tt.style.setProperty("--_arrowRotate", "45deg");
    }else{
      // au-dessus -> flÃ¨che en bas, rotation inversÃ©e
      tt.style.setProperty("--_arrowLeft", arrowX + "px");
      tt.style.setProperty("--_arrowTop", (ttr.height - 4) + "px");
      tt.style.setProperty("--_arrowRotate", "225deg");
    }
    // apply to pseudo element via inline style
    tt.style.setProperty("--arrowLeft", tt.style.getPropertyValue("--_arrowLeft"));
    tt.style.setProperty("--arrowTop", tt.style.getPropertyValue("--_arrowTop"));
    tt.style.setProperty("--arrowRotate", tt.style.getPropertyValue("--_arrowRotate"));

    // hack: set via CSS variables used in ::before below
    tt.style.setProperty("--gt-left", tt.style.getPropertyValue("--arrowLeft"));
    tt.style.setProperty("--gt-top", tt.style.getPropertyValue("--arrowTop"));
    tt.style.setProperty("--gt-rot", tt.style.getPropertyValue("--arrowRotate"));

    // repaint pseudo using css vars
    tt.style.setProperty("--_gtArrowLeft", arrowX + "px");
    if(preferBelow){
      tt.style.setProperty("--_gtArrowTop", "-6px");
      tt.style.setProperty("--_gtArrowRot", "45deg");
    }else{
      tt.style.setProperty("--_gtArrowTop", (ttr.height - 4) + "px");
      tt.style.setProperty("--_gtArrowRot", "225deg");
    }
  }

  function hideTip(){
    tt.classList.remove("show");
    // laisser la transition, puis display none
    window.clearTimeout(tt._hideT);
    tt._hideT = window.setTimeout(()=>{
      if(!tt.classList.contains("show")){
        tt.style.display = "none";
      }
    }, 140);
  }

  function bind(anchor){
    anchor.addEventListener("mouseenter", ()=>showTip(anchor));
    anchor.addEventListener("mouseleave", hideTip);
    anchor.addEventListener("focus", ()=>showTip(anchor));
    anchor.addEventListener("blur", hideTip);
    anchor.addEventListener("click", (e)=>{ e.preventDefault(); e.stopPropagation(); });
  }

  document.querySelectorAll(".help-tip").forEach(bind);

  // reposition on scroll/resize if visible
  window.addEventListener("scroll", ()=>{
    const active = document.querySelector(".help-tip:hover") || document.activeElement?.closest?.(".help-tip");
    if(tt.classList.contains("show") && active) showTip(active);
  }, {passive:true});
  window.addEventListener("resize", ()=>{
    const active = document.querySelector(".help-tip:hover") || document.activeElement?.closest?.(".help-tip");
    if(tt.classList.contains("show") && active) showTip(active);
  });
})();
</script>
</body>
</html>
